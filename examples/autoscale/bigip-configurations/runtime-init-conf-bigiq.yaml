---
bigip_ready_enabled: []
extension_packages:
  install_operations:
    - extensionHash: 15c1b919954a91b9ad1e469f49b7a0915b20de494b7a032da9eb258bbb7b6c49
      extensionType: do
      extensionVersion: 1.19.0
    - extensionHash: b33a96c84b77cff60249b7a53b6de29cc1e932d7d94de80cc77fb69e0b9a45a0
      extensionType: as3
      extensionVersion: 3.26.0
    - extensionHash: 9c617f5bb1bb0d08ec095ce568a6d5d2ef162e504cd183fe3540586200f9d950
      extensionType: fast
      extensionVersion: 1.7.0
    - extensionHash: b8c14a8b357f4dfcf59185b25a82f322ec98b17823be94cb3bd66f73c5e22781
      extensionType: ts
      extensionVersion: 1.16.0
extension_services:
  service_operations:
    - extensionType: do
      type: inline
      value:
        Common:
          class: Tenant
          dbVars:
            class: DbVariables
            restjavad.useextramb: true
            provision.extramb: 500
          myDns:
            class: DNS
            nameServers:
            - 8.8.8.8
          myLicense:
            class: License
            licenseType: licensePool
            bigIqHost: '192.168.1.4'
            bigIqUsername: azureuser
            bigIqPassword: "{{{BIGIQ_PASSWORD}}}"
            licensePool: clpv2
            skuKeyword1: F5-BIG-MSP-BT-1G
            tenant: myTenant
            unitOfMeasure: hourly
            reachable: false
            hypervisor: azure
            overwrite: false
          myNtp:
            class: NTP
            servers:
            - 0.pool.ntp.org
            timezone: UTC
          myProvisioning:
            asm: nominal
            class: Provision
            ltm: nominal
          mySystem:
            autoPhonehome: true
            class: System
            hostname: "{{HOST_NAME}}.local"
        async: true
        class: Device
        label: myBIG-IPdeclarationfordeclarativeonboarding
        schemaVersion: 1.0.0
    - extensionType: as3
      type: inline
      value:
        schemaVersion: 3.0.0
        class: ADC
        remark: Autoscale
        label: Autoscale
        Tenant_1:
          class: Tenant
          Shared:
            class: Application
            template: shared
            shared_pool:
              class: Pool
              members:
              - addressDiscovery: azure
                addressRealm: private            
                resourceGroup: '{{{RESOURCE_GROUP_NAME}}}'
                resourceId: uniqueString-app-vmss
                resourceType: scaleSet
                servicePort: 80
                subscriptionId: '{{{SUBSCRIPTION_ID}}}'
                updateInterval: 60
                useManagedIdentity: true
              monitors:
                - http
          HTTPS_Service:
            class: Application
            template: https
            WAFPolicy:
              class: WAF_Policy
              url: 'https://raw.githubusercontent.com/F5Networks/f5-azure-arm-templates-v2/master/examples/autoscale/bigip-configurations/Rapid_Depolyment_Policy_13_1.xml'
              ignoreChanges: false
              enforcementMode: blocking          
            serviceMain:
              class: Service_HTTPS
              virtualAddresses:
                - 0.0.0.0
              policyWAF:
                use: WAFPolicy
              pool: "/Tenant_1/Shared/shared_pool"
              serverTLS:
                bigip: "/Common/clientssl"
              redirect80: false
          HTTP_Service:
            class: Application
            template: http 
            WAFPolicy:
              class: WAF_Policy
              url: 'https://raw.githubusercontent.com/F5Networks/f5-azure-arm-templates-v2/master/examples/autoscale/bigip-configurations/Rapid_Depolyment_Policy_13_1.xml'
              ignoreChanges: false
              enforcementMode: blocking           
            serviceMain:
              class: Service_HTTP
              virtualAddresses:
                - 0.0.0.0
              policyWAF:
                use: WAFPolicy
              pool: "/Tenant_1/Shared/shared_pool"
    - extensionType: ts
      type: inline
      value:
        Azure_Consumer:
          appInsightsResourceName: dd-app-*
          class: Telemetry_Consumer
          maxBatchIntervalMs: 5000
          maxBatchSize: 250
          trace: true
          type: Azure_Application_Insights
          useManagedIdentity: true
        Bigip_Poller:
          actions:
          - includeData: {}
            locations:
              system:
                cpu: true
                networkInterfaces:
                  '1.0':
                    counters.bitsIn: true
          class: Telemetry_System_Poller
          interval: 60
        class: Telemetry
        controls:
          class: Controls
          debug: true
          logLevel: debug
post_onboard_enabled: []
pre_onboard_enabled: []
runtime_parameters:
- name: HOST_NAME
  type: metadata
  metadataProvider:
    environment: azure
    type: compute
    field: name
- name: BIGIQ_PASSWORD
  type: secret
  secretProvider:
    type: KeyVault
    environment: azure
    vaultUrl: https://myVaultName.vault.azure.net
    secretId: mySecret
- name: RESOURCE_GROUP_NAME
  type: url
  value: http://169.254.169.254/metadata/instance/compute?api-version=2020-09-01
  query: resourceGroupName
  headers:
    - name: Metadata
      value: true
- name: SUBSCRIPTION_ID
  type: url
  value: http://169.254.169.254/metadata/instance/compute?api-version=2020-09-01
  query: subscriptionId
  headers:
    - name: Metadata
      value: true